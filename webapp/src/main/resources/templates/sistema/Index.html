<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/superadmin/css/css_login.css">
    <link rel="icon" href="/assets/paciente/img/logo.png" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>PildoPharm Login</title>
    <style>
        .error-message {
            font-weight: bold;
            font-size: 18px;
        }

    </style>
</head>
<body>

<div th:replace="~{layout/MensajesTemplate :: mensajes}"></div>

<div class="container">
    <div class="signin-signup">
        <form method="post" th:action="@{/submitLoginForm}" class="sign-in-form" id="login-form">
            <h2 class="title">INICIA SESIÓN</h2>
            <div class="input-field">
                <i class="fas fa-user"></i>
                <input type="text" placeholder="Ingresa tu correo..." id="email" name="username">
                <div class="error" id="email-error"></div>
            </div>
            <div class="input-field">
                <i class="fas fa-lock"></i>
                <input  type="password" placeholder="Ingresa tu contraseña..." name="password">
            </div>

            <input type="submit" value="Login" class="btn" id="login-button" style="margin-top: 1vh">
            <button type="button" class="forgot-pass">¿Olvidaste tu contraseña?</button>
            <br>
            <p class="social-text">¡Visita nuestras redes sociales!</p>
            <div class="social-media">
                <a href="https://www.youtube.com/watch?v=nLvg_sqNYB0" class="social-icon" target="_blank">
                    <i class="fab fa-facebook"></i>
                </a>
                <a href="" class="social-icon">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="" class="social-icon">
                    <i class="fab fa-instagram"></i>
                </a>

            </div>
            <p class="account-text">¿No tienes una cuenta?<a href="#" id="sign-up-btn2"> Registro</a></p>
        </form>

        <form id="formReg" th:action="@{/registro}" class="sign-up-form" method="post">
            <h2 class="title">Pre-Registro</h2>
            <input th:value="${'4'}" name="nuevoRol" type="hidden" />
            <div class="input-field">
                <i class="fas fa-user-shield"></i>
                <input type="text" placeholder="Ingresa tu DNI" id="dni" name="dni">
                <div class="error" id="dni-error"></div>
            </div>

            <input type="submit" value="Registrar" class="btn" id="registro-button" style="margin-top: 1vh">
            <p class="account-text">¿Ya posees una cuenta?<a href="#" id="sign-in-btn2"> Ingresar</a></p>
        </form>
    </div>
    <div class="panels-container">
        <div class="panel left-panel">
            <div class="content">
                <h3>Adelante, empieza tu registro!</h3>
                <br><br>
                <p>
                    ¿Ya posees una cuenta?
                </p>
                <button class="btn" id="sign-in-btn">Ingresar</button>
                <br><br><br>
                <p class="social-text">¡Visita nuestras redes sociales!</p>
                <div class="social-media">
                    <a href="https://www.youtube.com/watch?v=nLvg_sqNYB0" class="social-icon" target="_blank">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="" class="social-icon">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="" class="social-icon">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="panel right-panel">
            <div class="content">
                <h3>¡Bienvenido a Pildopharm! Estamos encantados de tenerte aqui.</h3>
                <p>
                    Gracias a ti, continuamos creciendo.
                </p>
                <br>
                <p>
                    ¿Aun no tienes una cuenta?
                </p>
                <button class="btn" id="sign-up-btn">Registrarme</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="registroModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="registroModalLabel">Registro Exitoso</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Tu respectivo formulario fue enviado, en un plazo máximo de 48h recibiras una notificación sobre el estado de tu registro.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="ok-button">OK</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="forgotPasswordModalLabel">¿Olvidaste tu contraseña?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Ingresa tu dirección de correo electrónico asociada a tu cuenta para poder recuperarla.
                <div class="input-field1">
                    <i class="fas fa-envelope"></i>
                    <input type="text" id="forgot-password-email" placeholder="Correo">
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="reset-password-button">Enviar</button>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
<script src="/assets/superadmin/js/animacion.js"></script>

<script>


    document.addEventListener("DOMContentLoaded", function () {
        const dniInput = document.querySelector("#dni");
        const registroButton = document.querySelector("#registro-button");

        dniInput.addEventListener("input", validarDNI);

        function validarDNI() {
            const dniValue = dniInput.value.trim();
            const dniError = document.querySelector("#dni-error");

            if (!dniValue) {
                dniError.textContent = "Campo vacío";
                dniError.classList.add("error-message");
            } else if (!/^\d+$/.test(dniValue)) {
                dniError.textContent = "Solo números";
                dniError.classList.add("error-message");
            } else if (dniValue.length > 8) {
                dniError.textContent = "¡Solo 8 dígitos!";
                dniError.classList.add("error-message");
            } else if (dniValue.length < 8) {
                dniError.textContent = "8 dígitos requeridos";
                dniError.classList.add("error-message");
            } else {
                dniError.textContent = "";
                dniError.classList.remove("error-message");
            }
        }

        registroButton.addEventListener("click", function (e) {
            e.preventDefault();

            validarDNI();

            const dniError = document.querySelector("#dni-error");

            if (
                dniError.textContent === ""
            ) {
                //     const registroModal = new bootstrap.Modal(document.getElementById("registroModal"));
                //    registroModal.show();
                document.getElementById("formReg").submit();
            }
        });

        document.querySelector(".forgot-pass").addEventListener("click", function () {
            const forgotPasswordModal = new bootstrap.Modal(document.getElementById("forgotPasswordModal"));
            forgotPasswordModal.show();
        });

        function validarForgotPasswordEmail() {
            const forgotPasswordEmailInput = document.querySelector("#forgot-password-email");
            const forgotPasswordEmailValue = forgotPasswordEmailInput.value.trim();
            const regexForgotPasswordEmail = /^[a-zA-Z0-9_À-ÿ.-]+@[^@\s]+\.com$/;


            if (regexForgotPasswordEmail.test(forgotPasswordEmailValue)) {
                forgotPasswordEmailInput.placeholder = "Correo";
                forgotPasswordEmailInput.style.color = "black";
            } else {
                forgotPasswordEmailInput.placeholder = "Correo no válido";
                forgotPasswordEmailInput.style.color = "red";
            }
        }

        const forgotPasswordEmailInput = document.querySelector("#forgot-password-email");
        forgotPasswordEmailInput.addEventListener("input", validarForgotPasswordEmail);

        document.querySelector("#reset-password-button").addEventListener("click", function (e) {
            e.preventDefault();

            validarForgotPasswordEmail();

            if (forgotPasswordEmailInput.placeholder === "Correo") {
                var correo = document.getElementById("forgot-password-email").value;
                document.getElementById("reset-password-button").disabled = true;

                $.ajax({
                    type: "GET",
                    data: {
                        correo: correo
                    },
                    dataType: 'json',
                    url: "/reestablecer/generar_token",
                    success: function (data) {
                        if (data.response === "OK") {
                            const forgotPasswordModal = bootstrap.Modal.getInstance(document.getElementById("forgotPasswordModal"));
                            forgotPasswordModal.hide();
                            document.getElementById("forgot-password-email").value = "";
                            Swal.fire('¡Éxito!', "Envio correo correcto! Por favor revise su bandeja para poder reestablecer su contraseña.", 'success');
                        } else {
                            Swal.fire('¡Error!', data.response, 'error');
                        }
                    },
                    error: function (xhr, status, errorThrown) {
                        Swal.fire('¡Error!', "No se ha podido recuperar contraseña.", 'error');

                    }, complete: function () {
                        document.getElementById("reset-password-button").disabled = false;
                    }
                });

            }
        });
    });

</script>


</body>
</html>